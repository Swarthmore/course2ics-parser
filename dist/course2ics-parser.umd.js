!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){const{RRule:e}=require("rrule"),t=require("fs").promises,r=require("papaparse"),a=require("ics"),i=require("moment"),{validateArgs:n,validateRow:o}=require("./validators"),{daysFromString:s,timeDiff:c,firstDayAfterDate:u,flipName:l}=require("./helpers"),f=require("path"),m=require("pug");i().format(),i.suppressDeprecationWarnings=!0,module.exports={parse:async function(m){const p=e=>{m.verbose&&console.debug("string"==typeof e?e:JSON.stringify(e))};async function y({title:t,subject:r,course:n,section:o,instructor:f,email:m,days:p,times:y,fromDate:d,toDate:w}){const D=s(p),g=new e({freq:e.WEEKLY,byweekday:D.map(t=>{switch(t){case"U":return e.SU;case"M":return e.MO;case"T":return e.TU;case"W":return e.WE;case"R":return e.TH;case"F":return e.FR;case"S":return e.SA}}).filter(e=>e),until:new Date(w)}),b=u(d,p,y,i).format("YYYY-M-D-H-m").split("-"),h=c(y),[,j]=g.toString().split("RRULE:"),S={start:b,duration:h,recurrenceRule:j,title:`${r} ${n} ${o}`,description:t,status:"CONFIRMED",organizer:{name:l(f),email:m}};return new Promise((e,t)=>{a.createEvent(S,(r,a)=>{r&&t(r),e(a)})})}async function d(e,r){try{return await t.writeFile(r,e),r}catch(e){return e}}const w=await n(m),D=f.normalize(w.outputDir),g=await async function(e){try{return await t.readFile(e,"utf8")}catch(e){return e}}(f.normalize(w.inputFile));return async function(){return new Promise((e,a)=>{r.parse(g,{complete:async r=>{let i=[];const n=r.data.slice(1);0===n.length&&a("No rows could be parsed from csv");let s=0;var c,u=!0,l=!1;try{for(var m,g,b=function(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}(n);u=(m=await b.next()).done,g=await m.value,!u;u=!0){let e=g;try{p("-------------------------------------------"),p("Processing row "+s),p(e);const t=await o(e),[r,a,n,c,u,l,m,g,b,h,j,S]=t,F=await y({title:r,subject:a,course:n,section:S,instructor:c,email:l,days:g,times:h,fromDate:w.fromDate,toDate:w.toDate}),$=`${r.replace(/[/\\?%*:|"<>\s]/g,"-")}__${S}_${g.replace(/,/g,"")}__${h.replace(/[:-\s]/g,"")}`,q=".ics",v=f.join(D,$+q),_=await d(F,v);if(p("Created "+_),i.push({title:r,subject:a,course:n,section:S,instructor:c,email:l,days:g,times:h,fromDate:w.fromDate,toDate:w.toDate,filename:f.basename(_)}),b&&j){const e=await y({title:r,subject:a,course:n,section:S,instructor:c,email:l,days:b,times:j,fromDate:w.fromDate,toDate:w.toDate}),t=`${r.replace(/[/\\?%*:|"<>\s]/g,"-")}__${S}_${b.replace(/,/g,"")}__${j.replace(/[:-\s]/g,"")}`,o=f.join(D,t+q),s=await d(e,o);p("Created "+s),i.push({title:r,subject:a,course:n,section:S,instructor:c,email:l,days:b,times:j,fromDate:w.fromDate,toDate:w.toDate,filename:f.basename(s)})}}catch(e){p(e)}finally{s++}}}catch(e){l=!0,c=e}finally{try{u||null==b.return||await b.return()}finally{if(l)throw c}}await t.writeFile(D+"/index.json",JSON.stringify(i),"utf8"),p("Done!"),e(i)}})})}()},makeSite:async function(e){const r=await t.readdir(e),[a]=r.filter(e=>".json"===f.extname(e));if(!a)throw new Error("No index file found");const i=await t.readFile(f.join(e,a)),n=m.compileFile(f.join(process.cwd(),"src","templates","report.pug"))({results:i});await t.writeFile(f.join(e,"index.html"),n,"utf8")}}});
//# sourceMappingURL=course2ics-parser.umd.js.map
