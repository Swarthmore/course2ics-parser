{"version":3,"file":"course2ics-parser.umd.js","sources":["../src/index.js"],"sourcesContent":["const { RRule } = require('rrule')\r\nconst fs = require('fs').promises\r\nconst Papa = require('papaparse')\r\nconst ics = require('ics')\r\nconst moment = require('moment')\r\nconst { validateArgs, validateRow } = require('./validators')\r\nconst { daysFromString, timeDiff, firstDayAfterDate, flipName } = require('./helpers')\r\nconst path = require('path')\r\nconst pug = require('pug')\r\n\r\n// See: https://momentjs.com/docs/#/use-it/node-js/\r\nmoment().format()\r\n\r\n// See: https://github.com/moment/moment/issues/3488\r\nmoment.suppressDeprecationWarnings = true;\r\n\r\nasync function makeSite(outputDir) {\r\n\r\n  // Get the files json file in the directory\r\n  const files = await fs.readdir(outputDir)\r\n\r\n  const [index] = files.filter(file => path.extname(file) === '.json') \r\n\r\n  if (!index) {\r\n    throw new Error('No index file found')\r\n  }\r\n\r\n  // Get the file contents of index json\r\n  const json = await fs.readFile(path.join(outputDir, index))\r\n\r\n  // If the index file exists, create the file using the template\r\n  const compiledFunction = pug.compileFile(path.join(process.cwd(), 'src', 'templates', 'report.pug'))\r\n\r\n  const html = compiledFunction({ results: json })\r\n\r\n  // Write index.html to the output directory\r\n  await fs.writeFile(path.join(outputDir, 'index.html'), html, 'utf8')\r\n\r\n}\r\n\r\n/**\r\n * Parses a csv and creates an ics file for each row. The generated ics will contain events recurring weekly from\r\n * the given fromDate until the given toDate.\r\n *  \r\n * @param {Object}  argv - The function arguments\r\n * @param {boolean} argv.verbose - Runs the function in verbose mode\r\n * @param {string}  argv.outputDir - The directory to save the files to. This directory must exist.\r\n * @param {string}  argv.inputFile - The input csv\r\n * @param {string}  argv.toDate - The starting date\r\n * @param {string}  argv.fromDate - The end date\r\n * \r\n * @returns {Promise<void>}\r\n */\r\n\r\nasync function parse(argv) {\r\n\r\n  /**\r\n   * Output a debug message. This will only work if --verbose is passed to the script\r\n   * @param {string} message - The message to output \r\n   * @returns void\r\n   */\r\n  const debugMessage = (message) => {\r\n    if (!argv.verbose) return\r\n    console.debug(\r\n      typeof message === 'string' ? message : JSON.stringify(message)\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Reads a CSV file from disk\r\n   * @param {string} filepath - The path to the csv\r\n   * @returns {Promise<string>} - The contents of the file\r\n   */\r\n  async function readCsv(filepath) {\r\n    try {\r\n      return await fs.readFile(filepath, 'utf8')\r\n    } catch (e) {\r\n      return e\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates an ics event\r\n   * \r\n   * @param {Object} args - The function arguments\r\n   * @param {string} args.subject\r\n   * @param {string} args.course\r\n   * @param {string} args.section\r\n   * @param {string} args.instructor\r\n   * @param {string} args.email\r\n   * @param {string} args.days\r\n   * @param {string} args.times\r\n   * @param {string} args.fromDate\r\n   * @param {string} args.toDate \r\n   * \r\n   * @returns {Promise<string>} - Returns a promise that resolves with the ICS event\r\n   */\r\n  async function createIcsEvent({ title, subject, course, section, instructor, email, days, times, fromDate, toDate }) {\r\n\r\n    const daysArr = daysFromString(days)\r\n\r\n    const rrule = new RRule({\r\n      freq: RRule.WEEKLY,\r\n      byweekday: daysArr.map(day => {\r\n        switch (day) {\r\n          case 'U':\r\n            return RRule.SU\r\n          case 'M':\r\n            return RRule.MO\r\n          case 'T':\r\n            return RRule.TU\r\n          case 'W':\r\n            return RRule.WE\r\n          case 'R':\r\n            return RRule.TH\r\n          case 'F':\r\n            return RRule.FR\r\n          case 'S':\r\n            return RRule.SA\r\n          default:\r\n            break\r\n        }\r\n      }).filter(day => day),\r\n      until: new Date(toDate)\r\n    })\r\n\r\n    const firstDay = firstDayAfterDate(fromDate, days, times, moment)\r\n\r\n    const start = firstDay.format('YYYY-M-D-H-m').split(\"-\")\r\n\r\n    const duration = timeDiff(times)\r\n\r\n    // rrule.toString() will include the beginning RRULE:\r\n    // This is not needed with the ics library\r\n    // This line of code splits the returned rrule string at RRULE: and assigns the\r\n    // second part (the part we need) to a variable.\r\n    const [, recurrenceRule] = rrule.toString().split('RRULE:')\r\n\r\n    const eventTitle = `${subject} ${course} ${section}`\r\n\r\n    const event = {\r\n      // Start is in the format [year, month, day, hour, min]\r\n      start: start,\r\n      duration: duration,\r\n      recurrenceRule: recurrenceRule,\r\n      title: eventTitle,\r\n      description: title,\r\n      status: 'CONFIRMED',\r\n      organizer: {\r\n        name: flipName(instructor),\r\n        email: email\r\n      }\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      ics.createEvent(event, (err, val) => {\r\n        if (err) reject(err)\r\n        resolve(val)\r\n      })\r\n    })\r\n\r\n  }\r\n\r\n  /**\r\n   * Writes an ics file to disk\r\n   * @param {string} icsData - The generated ics data \r\n   * @param {string} fileName - The full file name to save\r\n   * @returns {Promise<string>} - Returns a promise that will resolve with the created filename\r\n   */\r\n  async function writeIcsToDisk(icsData, fileName) {\r\n    try {\r\n      await fs.writeFile(fileName, icsData)\r\n      return fileName\r\n    } catch (e) {\r\n      return e\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Runs the parser\r\n   * @return {Promise<{ title: string; subject: string; course: string; section: string; instructor: string; email: string; days: string; times: string; fromDate: any; toDate: any; filename: string; }[]>} - Returns a promise that resolves with the created files\r\n   */\r\n  async function runParser() {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n      Papa.parse(csv, {\r\n        complete: async results => {\r\n\r\n          // keep track of the created files, along with the source row\r\n          let created = []\r\n\r\n          // Get the rows from papa parse\r\n          const rows = results.data.slice(1)\r\n\r\n          if (rows.length === 0) {\r\n            reject('No rows could be parsed from csv')\r\n          }\r\n\r\n          let i = 0\r\n\r\n          for await (let r of rows) {\r\n\r\n            try {\r\n              debugMessage('-------------------------------------------')\r\n              debugMessage(`Processing row ${i}`)\r\n              debugMessage(r)\r\n\r\n              // validate the row\r\n              const row = await validateRow(r)\r\n\r\n              const [title, subject, course, instr1, instr2, email1, email2, days1, days2, time1, time2, section] = row\r\n\r\n              const ics1 = await createIcsEvent({\r\n                title,\r\n                subject,\r\n                course,\r\n                section,\r\n                instructor: instr1,\r\n                email: email1,\r\n                days: days1,\r\n                times: time1,\r\n                fromDate: args.fromDate,\r\n                toDate: args.toDate\r\n              })\r\n\r\n              // Set the file name\r\n              const fn1 = `${title.replace(/[/\\\\?%*:|\"<>\\s]/g, '-')}__${section}_${days1.replace(/,/g, '')}__${time1.replace(/[:-\\s]/g, '')}`\r\n              const ext = '.ics'\r\n\r\n              const fp1 = path.join(outputDir, fn1 + ext)\r\n              const f1 = await writeIcsToDisk(ics1, fp1)\r\n              debugMessage('Created' + ' ' + f1)\r\n\r\n              created.push({\r\n                title,\r\n                subject,\r\n                course,\r\n                section,\r\n                instructor: instr1,\r\n                email: email1,\r\n                days: days1,\r\n                times: time1,\r\n                fromDate: args.fromDate,\r\n                toDate: args.toDate,\r\n                filename: f1\r\n              })\r\n\r\n              if (days2 && time2) {\r\n                const ics2 = await createIcsEvent({\r\n                  title,\r\n                  subject,\r\n                  course,\r\n                  section,\r\n                  instructor: instr1,\r\n                  email: email1,\r\n                  days: days2,\r\n                  times: time2,\r\n                  fromDate: args.fromDate,\r\n                  toDate: args.toDate\r\n                })\r\n                const fn2 = `${title.replace(/[/\\\\?%*:|\"<>\\s]/g, '-')}__${section}_${days2.replace(/,/g, '')}__${time2.replace(/[:-\\s]/g, '')}`\r\n                const fp2 = path.join(outputDir, fn2 + ext)\r\n                const f2 = await writeIcsToDisk(ics2, fp2)\r\n                debugMessage('Created' + ' ' + f2)\r\n\r\n                created.push({\r\n                  title,\r\n                  subject,\r\n                  course,\r\n                  section,\r\n                  instructor: instr1,\r\n                  email: email1,\r\n                  days: days2,\r\n                  times: time2,\r\n                  fromDate: args.fromDate,\r\n                  toDate: args.toDate,\r\n                  filename: f2\r\n                })\r\n              }\r\n\r\n            } catch (e) {\r\n              debugMessage(e)\r\n            } finally {\r\n              i++\r\n            }\r\n\r\n          }\r\n\r\n          // once everything is done processing, create the index json file\r\n          await fs.writeFile(outputDir + '/' + 'index.json', JSON.stringify(created), 'utf8')\r\n\r\n          debugMessage('Done!')\r\n\r\n          resolve(created)\r\n\r\n        }\r\n      })\r\n\r\n    })\r\n\r\n  }\r\n\r\n  // Validate the arguments\r\n  const args = await validateArgs(argv)\r\n\r\n  // Set the output directory based on the arguments provided\r\n  const outputDir = path.normalize(args.outputDir)\r\n\r\n  // Read the CSV\r\n  const csv = await readCsv(path.normalize(args.inputFile))\r\n\r\n  return runParser()\r\n\r\n}\r\n\r\nmodule.exports = { parse, makeSite }"],"names":["RRule","require","fs","promises","Papa","ics","moment","validateArgs","validateRow","daysFromString","timeDiff","firstDayAfterDate","flipName","path","pug","format","suppressDeprecationWarnings","makeSite","outputDir","files","readdir","index","filter","file","extname","Error","json","readFile","join","compiledFunction","compileFile","process","cwd","html","results","writeFile","parse","argv","debugMessage","message","verbose","console","debug","JSON","stringify","readCsv","filepath","e","createIcsEvent","title","subject","course","section","instructor","email","days","times","fromDate","toDate","daysArr","rrule","freq","WEEKLY","byweekday","map","day","SU","MO","TU","WE","TH","FR","SA","until","Date","firstDay","start","split","duration","recurrenceRule","toString","eventTitle","event","description","status","organizer","name","Promise","resolve","reject","createEvent","err","val","writeIcsToDisk","icsData","fileName","runParser","csv","complete","created","rows","data","slice","length","i","r","row","instr1","instr2","email1","email2","days1","days2","time1","time2","ics1","args","fn1","replace","ext","fp1","f1","push","filename","ics2","fn2","fp2","f2","normalize","inputFile","module","exports"],"mappings":"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"}